
# Load required packages

if(!require(pacman)){               
  install.packages("pacman")
  library(pacman)
}

if(!require(BiocManager)){               
  install.packages("BiocManager")
  library(BiocManager)
}

p_install(boot, force=FALSE)
p_load(boot)

# Set literature-based parameter values

Qd <- 0                               # QALY for death
Qs <- 1                               # QALY for survive

Cro <- 900                            # Cost of ruling out AMI
Csk <- 1700                            # Cost of Streptokinase (SK)
Cbl <- 2050                           # Cost of bleeding
Cmi <- 4100                           # Cost of AMI

# Generate PSA parameters: SK = Streptokinase, CT = Conservative therapy

N <- 1000000                          # PSA sample size

Psbl <- rbeta(N, 3, 40)               # Draw a sample probability of bleeding given SK from prior distribution 
                                      #   constructed using mean = 0.07 and variance = 0.0015.
Pcbl <- rbeta(N, 1.5, 36)             # Draw a sample probability of bleeding given CT from prior distribution
                                      #   constructed using mean = 0.04 and variance = 0.0010.
Pcmi <- rbeta(N, 6.2, 24.8)           # Draw a sample probability of AMI given CT from prior distribution constructed  
                                      #   using mean = 0.2 and variance = 0.005.
OR <- exp(rnorm(N,-0.3883, sqrt(1/4)))        # Draw a sample Odds Ratio (OR) from prior distribution constructed 
                                              #    using OR = 0.6782 and variance = 1.2841.
Psmi <- inv.logit(log(Pcmi/(1-Pcmi))+log(OR)) 
                                              

# Run model simulation

# Estimate cost

cost.Control <-                       # Cost in CT
  Pcbl*(Cro+Cbl) + 
  ((1-Pcbl)*Pcmi)*(Cro+Cmi) + 
  ((1-Pcbl)*(1-Pcmi))*Cro

cost.Streptokinase <-                 # Cost in SK
  Psbl*(Csk+Cbl) + 
  ((1-Psbl)*Psmi)*(Csk+Cmi) + 
  ((1-Psbl)*(1-Psmi))*Csk

# Estimate utility

utility.Control <-                    # Utility in CT
  Pcbl*Qd + 
  ((1-Pcbl)*Pcmi)*Qd + 
  ((1-Pcbl)*(1-Pcmi))*Qs

utility.Streptokinase <-              # Utility in SK
  Psbl*Qd + 
  ((1-Psbl)*Psmi)*Qd + 
  ((1-Psbl)*(1-Psmi))*Qs

# Perform baseline cost and effectiveness analysis

cost <- data.frame("Streptokinase"=cost.Streptokinase,
                   "Control"=cost.Control)

utility <- data.frame("Streptokinase"=utility.Streptokinase,
                      "Control"=utility.Control)

theta <- data.frame(Qd=Qd,
                    Qs=Qs,
                    Cro=Cro,
                    Csk=Csk,
                    Cbl=Cbl,
                    Cmi=Cmi,
                    Psbl=Psbl,
                    Pcbl=Pcbl,
                    Pcmi=Pcmi,
                    OR=OR,
                    Psmi=Psmi)
                    
